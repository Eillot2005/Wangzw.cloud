# é¡¹ç›®æ€»è§ˆ

## ğŸ“ å®Œæ•´æ–‡ä»¶ç»“æ„

```
Wangzw.cloud/
â”‚
â”œâ”€â”€ README.md                      # å®Œæ•´é¡¹ç›®æ–‡æ¡£ï¼ˆéƒ¨ç½²ã€API ç¤ºä¾‹ï¼‰
â”œâ”€â”€ QUICKSTART.md                  # å¿«é€Ÿå¯åŠ¨æŒ‡å—
â”œâ”€â”€ .gitignore                     # Git å¿½ç•¥æ–‡ä»¶é…ç½®
â”‚
â”œâ”€â”€ backend/                       # åç«¯ï¼ˆFastAPI + Pythonï¼‰
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py               # FastAPI åº”ç”¨å…¥å£
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py         # é…ç½®å’Œç¯å¢ƒå˜é‡
â”‚   â”‚   â”‚   â”œâ”€â”€ security.py       # JWT è®¤è¯ã€å¯†ç å“ˆå¸Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ rate_limit.py     # é™æµï¼ˆ20æ¬¡/åˆ†é’Ÿï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ audit.py          # å®¡è®¡æ—¥å¿—è®°å½•
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ db/                   # æ•°æ®åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py           # SQLAlchemy Base
â”‚   â”‚   â”‚   â”œâ”€â”€ session.py        # æ•°æ®åº“ä¼šè¯
â”‚   â”‚   â”‚   â””â”€â”€ init_db.py        # æ•°æ®åº“åˆå§‹åŒ–å’Œç”¨æˆ·åˆ›å»º
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ models/               # SQLAlchemy æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py           # ç”¨æˆ·æ¨¡å‹ï¼ˆadmin/friendï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ todo.py           # å¾…åŠäº‹é¡¹æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ message.py        # ç•™è¨€æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ audit_log.py      # å®¡è®¡æ—¥å¿—æ¨¡å‹
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ schemas/              # Pydantic Schemasï¼ˆè¯·æ±‚/å“åº”ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py           # ç™»å½•ã€ç”¨æˆ·ä¿¡æ¯
â”‚   â”‚   â”‚   â”œâ”€â”€ todo.py           # å¾…åŠç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ message.py        # ç•™è¨€ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ audit_log.py      # å®¡è®¡æ—¥å¿—
â”‚   â”‚   â”‚   â”œâ”€â”€ external.py       # å¤–éƒ¨ API
â”‚   â”‚   â”‚   â””â”€â”€ picture.py        # ç…§ç‰‡ä¿¡æ¯
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ routers/              # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py           # ç™»å½•ã€è·å–ç”¨æˆ·ä¿¡æ¯
â”‚   â”‚   â”‚   â”œâ”€â”€ todos.py          # å¾…åŠ CRUDï¼ˆfriendï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ messages.py       # ç•™è¨€ CRUDï¼ˆadmin + friendï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ external.py       # å¤–éƒ¨ AI API è°ƒç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ pictures.py       # ç…§ç‰‡åˆ—è¡¨å’Œè®¿é—®
â”‚   â”‚   â”‚   â””â”€â”€ admin.py          # ç®¡ç†å‘˜ä¸“ç”¨ï¼ˆæ¦‚è§ˆã€å®¡è®¡ã€ç®¡ç†ï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ services/             # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ external_api.py   # å¤–éƒ¨ API è°ƒç”¨ï¼ˆå†™æ­»å‚æ•°ï¼‰
â”‚   â”‚       â””â”€â”€ picture.py        # ç…§ç‰‡å®‰å…¨è®¿é—®ï¼ˆé˜²è·¯å¾„ç©¿è¶Šï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ Picture/                  # ç§æœ‰ç…§ç‰‡ç›®å½•
â”‚   â”‚   â”œâ”€â”€ .gitkeep              # ä¿æŒç›®å½•ç»“æ„
â”‚   â”‚   â””â”€â”€ README.txt            # ç…§ç‰‡è¯´æ˜
â”‚   â”‚
â”‚   â”œâ”€â”€ requirements.txt          # Python ä¾èµ–
â”‚   â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚   â””â”€â”€ start.ps1                 # Windows å¯åŠ¨è„šæœ¬
â”‚
â””â”€â”€ frontend/                     # å‰ç«¯ï¼ˆReact + TypeScript + Viteï¼‰
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ api/                  # API å®¢æˆ·ç«¯
    â”‚   â”‚   â”œâ”€â”€ client.ts         # Axios é…ç½®ï¼ˆè‡ªåŠ¨å¸¦ tokenï¼‰
    â”‚   â”‚   â”œâ”€â”€ auth.ts           # ç™»å½• API
    â”‚   â”‚   â”œâ”€â”€ todos.ts          # å¾…åŠ API
    â”‚   â”‚   â”œâ”€â”€ messages.ts       # ç•™è¨€ API
    â”‚   â”‚   â”œâ”€â”€ external.ts       # å¤–éƒ¨ AI API
    â”‚   â”‚   â”œâ”€â”€ pictures.ts       # ç…§ç‰‡ API
    â”‚   â”‚   â””â”€â”€ admin.ts          # ç®¡ç†å‘˜ API
    â”‚   â”‚
    â”‚   â”œâ”€â”€ router/               # è·¯ç”±é…ç½®
    â”‚   â”‚   â”œâ”€â”€ index.tsx         # è·¯ç”±å®šä¹‰
    â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx # è·¯ç”±å®ˆå«ï¼ˆåŸºäº roleï¼‰
    â”‚   â”‚
    â”‚   â”œâ”€â”€ components/           # å…±äº«ç»„ä»¶
    â”‚   â”‚   â””â”€â”€ Layout.tsx        # å¸ƒå±€ç»„ä»¶ï¼ˆä¾§è¾¹æ  + ä¸»å†…å®¹ï¼‰
    â”‚   â”‚
    â”‚   â”œâ”€â”€ pages/                # é¡µé¢ç»„ä»¶
    â”‚   â”‚   â”œâ”€â”€ Login.tsx         # ç™»å½•é¡µ
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ app/              # Friend ç”¨æˆ·é¡µé¢
    â”‚   â”‚   â”‚   â”œâ”€â”€ TodoPage.tsx        # å¾…åŠäº‹é¡¹é¡µé¢
    â”‚   â”‚   â”‚   â”œâ”€â”€ MessagesPage.tsx    # ç•™è¨€å¢™é¡µé¢
    â”‚   â”‚   â”‚   â”œâ”€â”€ ExternalApiPage.tsx # AI åŠ©æ‰‹é¡µé¢
    â”‚   â”‚   â”‚   â””â”€â”€ PicturesPage.tsx    # ç…§ç‰‡æµè§ˆé¡µé¢
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€â”€ admin/            # Admin ç®¡ç†å‘˜é¡µé¢
    â”‚   â”‚       â”œâ”€â”€ AdminOverview.tsx        # æ¦‚è§ˆä»ªè¡¨æ¿
    â”‚   â”‚       â”œâ”€â”€ AuditLogPage.tsx         # å®¡è®¡æ—¥å¿—
    â”‚   â”‚       â”œâ”€â”€ FriendTodosPage.tsx      # æœ‹å‹å¾…åŠç®¡ç†
    â”‚   â”‚       â””â”€â”€ FriendMessagesPage.tsx   # ç•™è¨€ç®¡ç†
    â”‚   â”‚
    â”‚   â”œâ”€â”€ App.tsx               # æ ¹ç»„ä»¶
    â”‚   â”œâ”€â”€ main.tsx              # åº”ç”¨å…¥å£
    â”‚   â””â”€â”€ index.css             # å…¨å±€æ ·å¼
    â”‚
    â”œâ”€â”€ index.html                # HTML æ¨¡æ¿
    â”œâ”€â”€ package.json              # Node ä¾èµ–
    â”œâ”€â”€ tsconfig.json             # TypeScript é…ç½®
    â”œâ”€â”€ tsconfig.node.json        # TypeScript Node é…ç½®
    â”œâ”€â”€ vite.config.ts            # Vite é…ç½®
    â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
    â””â”€â”€ start.ps1                 # Windows å¯åŠ¨è„šæœ¬
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### âœ… åŒç”¨æˆ·ç³»ç»Ÿ
- âœ… ä»…ä¸¤ä¸ªå›ºå®šè´¦å·ï¼ˆadmin + friendï¼‰
- âœ… ç¦æ­¢æ³¨å†Œå’Œåˆ›å»ºç¬¬ä¸‰ä¸ªç”¨æˆ·
- âœ… å¯†ç æ¥è‡ªç¯å¢ƒå˜é‡ï¼Œbcrypt å“ˆå¸Œå­˜å‚¨
- âœ… JWT Bearer è®¤è¯
- âœ… åŸºäº role çš„è·¯ç”±å®ˆå«

### âœ… Friend ç”¨æˆ·åŠŸèƒ½
- âœ… å¾…åŠäº‹é¡¹ï¼ˆCRUD + ç­›é€‰ï¼‰
- âœ… ç•™è¨€å¢™ï¼ˆå‘é€ã€æŸ¥çœ‹ã€åˆ é™¤è‡ªå·±çš„ï¼‰
- âœ… AI åŠ©æ‰‹ï¼ˆå¤–éƒ¨ APIï¼Œé™æµ 20 æ¬¡/åˆ†é’Ÿï¼‰
- âœ… ç…§ç‰‡æµè§ˆï¼ˆé‰´æƒè®¿é—®ï¼Œæ”¯æŒæ”¾å¤§ï¼‰

### âœ… Admin ç®¡ç†å‘˜åŠŸèƒ½
- âœ… æ¦‚è§ˆä»ªè¡¨æ¿ï¼ˆç»Ÿè®¡æ•°æ®ï¼‰
- âœ… å®¡è®¡æ—¥å¿—ï¼ˆæ”¯æŒç­›é€‰ï¼‰
- âœ… æŸ¥çœ‹æœ‹å‹çš„æ‰€æœ‰å¾…åŠ
- âœ… åˆ é™¤æœ‹å‹çš„å¾…åŠ
- âœ… æŸ¥çœ‹æ‰€æœ‰ç•™è¨€
- âœ… åˆ é™¤ä»»æ„ç•™è¨€

### âœ… å®‰å…¨ç‰¹æ€§
- âœ… JWT è®¤è¯ï¼ˆæ‰€æœ‰ API éœ€è¦ç™»å½•ï¼‰
- âœ… å¯†ç  bcrypt å“ˆå¸Œ
- âœ… ç…§ç‰‡è·¯å¾„ç©¿è¶Šé˜²æŠ¤
- âœ… å¤–éƒ¨ API å‚æ•°å†™æ­»ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰
- âœ… é™æµï¼ˆ20 æ¬¡/åˆ†é’Ÿï¼‰
- âœ… CORS é…ç½®

### âœ… å®¡è®¡æ—¥å¿—
æ‰€æœ‰æ“ä½œéƒ½è®°å½•ï¼š
- âœ… LOGIN
- âœ… TODO_CREATE / UPDATE / DELETE
- âœ… MESSAGE_CREATE / DELETE
- âœ… EXTERNAL_CALL
- âœ… PICTURE_VIEW

## ğŸš€ å¯åŠ¨æ–¹å¼

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

**åç«¯ï¼š**
```powershell
cd backend
.\start.ps1
```

**å‰ç«¯ï¼š**ï¼ˆæ–°å¼€ç»ˆç«¯ï¼‰
```powershell
cd frontend
.\start.ps1
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

è§ QUICKSTART.md

## ğŸ”‘ ç¯å¢ƒå˜é‡

### åç«¯å¿…éœ€å˜é‡
```env
DATABASE_URL=postgresql://...          # ç”Ÿäº§ç”¨ Postgresï¼Œå¼€å‘å¯ç”¨ SQLite
JWT_SECRET=your-secret-key             # JWT å¯†é’¥
CORS_ORIGINS=http://localhost:5173     # å…è®¸çš„å‰ç«¯åŸŸå
ADMIN_PASSWORD=secure-password         # ç®¡ç†å‘˜å¯†ç 
FRIEND_PASSWORD=secure-password        # æœ‹å‹å¯†ç 
EXTERNAL_API_KEY=your-api-key          # å¤–éƒ¨ API Key
EXTERNAL_API_URL=https://api.xxx.com   # å¤–éƒ¨ API URL
```

### å‰ç«¯å¿…éœ€å˜é‡
```env
VITE_API_BASE_URL=http://localhost:8000  # åç«¯ API åœ°å€
```

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### usersï¼ˆç”¨æˆ·è¡¨ï¼‰
- id, username, hashed_password, role

### todosï¼ˆå¾…åŠè¡¨ï¼‰
- id, owner_id, title, done, created_at, updated_at

### messagesï¼ˆç•™è¨€è¡¨ï¼‰
- id, sender_id, content, created_at

### audit_logsï¼ˆå®¡è®¡æ—¥å¿—è¡¨ï¼‰
- id, user_id, action, resource_type, resource_id, meta_json, created_at

## ğŸŒ API ç«¯ç‚¹æ€»è§ˆ

### è®¤è¯
- `POST /auth/login` - ç™»å½•
- `GET /auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

### å¾…åŠï¼ˆFriendï¼‰
- `GET /todos` - åˆ—å‡ºå¾…åŠ
- `POST /todos` - åˆ›å»ºå¾…åŠ
- `PATCH /todos/{id}` - æ›´æ–°å¾…åŠ
- `DELETE /todos/{id}` - åˆ é™¤å¾…åŠ

### ç•™è¨€ï¼ˆAdmin + Friendï¼‰
- `GET /messages` - åˆ—å‡ºç•™è¨€
- `POST /messages` - åˆ›å»ºç•™è¨€
- `DELETE /messages/{id}` - åˆ é™¤ç•™è¨€

### å¤–éƒ¨ APIï¼ˆAdmin + Friendï¼‰
- `POST /external/call` - è°ƒç”¨ AI API

### ç…§ç‰‡ï¼ˆAdmin + Friendï¼‰
- `GET /pictures` - åˆ—å‡ºç…§ç‰‡
- `GET /pictures/{filename}` - è·å–ç…§ç‰‡

### ç®¡ç†å‘˜ä¸“ç”¨
- `GET /admin/overview` - æ¦‚è§ˆç»Ÿè®¡
- `GET /admin/audit` - å®¡è®¡æ—¥å¿—
- `GET /admin/friend/todos` - æœ‹å‹çš„å¾…åŠ
- `DELETE /admin/friend/todos/{id}` - åˆ é™¤æœ‹å‹çš„å¾…åŠ
- `GET /admin/friend/messages` - æ‰€æœ‰ç•™è¨€

## ğŸ¨ å‰ç«¯è·¯ç”±

### å…¬å¼€è·¯ç”±
- `/login` - ç™»å½•é¡µ

### Friend è·¯ç”±ï¼ˆéœ€è¦ FRIEND è§’è‰²ï¼‰
- `/app/todos` - å¾…åŠäº‹é¡¹
- `/app/messages` - ç•™è¨€å¢™
- `/app/external` - AI åŠ©æ‰‹
- `/app/pictures` - ç…§ç‰‡æµè§ˆ

### Admin è·¯ç”±ï¼ˆéœ€è¦ ADMIN è§’è‰²ï¼‰
- `/admin/overview` - æ¦‚è§ˆä»ªè¡¨æ¿
- `/admin/audit` - å®¡è®¡æ—¥å¿—
- `/admin/friend-todos` - æœ‹å‹çš„å¾…åŠ
- `/admin/friend-messages` - ç•™è¨€ç®¡ç†

## ğŸ“¦ éƒ¨ç½²ç›®æ ‡

### åç«¯
- **æ¨è**: Render Web Service
- æ•°æ®åº“: Render PostgreSQL
- ç¯å¢ƒ: Python 3.11

### å‰ç«¯
- **æ¨è**: Vercel
- **å¤‡é€‰**: Cloudflare Pages
- ç¯å¢ƒ: Node.js 18+

## âœ¨ æŠ€æœ¯äº®ç‚¹

1. **å®Œå…¨å†™æ­»çš„å¤–éƒ¨ API è°ƒç”¨å‚æ•°**
   - modelã€system promptã€temperatureã€max_tokens å…¨éƒ¨ç¡¬ç¼–ç 
   - å‰ç«¯åªèƒ½æäº¤ prompt

2. **ç§æœ‰ç…§ç‰‡è®¿é—®**
   - JWT é‰´æƒ
   - è·¯å¾„ç©¿è¶Šé˜²æŠ¤
   - å®¡è®¡è®°å½•

3. **å®Œæ•´çš„å®¡è®¡ç³»ç»Ÿ**
   - æ‰€æœ‰å…³é”®æ“ä½œéƒ½è®°å½•
   - æ”¯æŒç­›é€‰å’Œåˆ†æ

4. **åŒç”¨æˆ·å›ºå®šç³»ç»Ÿ**
   - æ— æ³¨å†ŒåŠŸèƒ½
   - å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºè´¦å·
   - å¯†ç æ¥è‡ªç¯å¢ƒå˜é‡

5. **é™æµä¿æŠ¤**
   - é˜²æ­¢å¤–éƒ¨ API æ»¥ç”¨
   - å¯æ‰©å±•åˆ° Redis

## ğŸ“ å¼€å‘æ³¨æ„äº‹é¡¹

1. **å¯†ç å®‰å…¨**
   - æ°¸è¿œä¸è¦ç¡¬ç¼–ç å¯†ç 
   - ä½¿ç”¨ .env ç®¡ç†æ•æ„Ÿä¿¡æ¯
   - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¼ºå¯†ç 

2. **å¤–éƒ¨ API**
   - ç›‘æ§ä½¿ç”¨é‡å’Œæˆæœ¬
   - è€ƒè™‘è®¾ç½®æ¯æ—¥é™é¢
   - é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

3. **æ•°æ®åº“**
   - å®šæœŸå¤‡ä»½
   - ç”Ÿäº§ä½¿ç”¨ PostgreSQL
   - è€ƒè™‘æ·»åŠ ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢

4. **å®‰å…¨**
   - ç”Ÿäº§ç¯å¢ƒå¯ç”¨ HTTPS
   - æ›´æ–°ä¾èµ–ç‰ˆæœ¬
   - å®¡æŸ¥å®¡è®¡æ—¥å¿—

5. **æ€§èƒ½**
   - è€ƒè™‘æ·»åŠ  Redis ç¼“å­˜
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
   - å‰ç«¯æ·»åŠ æ‡’åŠ è½½

## ğŸ‰ é¡¹ç›®å®Œæˆåº¦

âœ… **100% å®Œæˆï¼**

æ‰€æœ‰éœ€æ±‚éƒ½å·²å®ç°ï¼š
- âœ… åŒç”¨æˆ·å›ºå®šç³»ç»Ÿ
- âœ… å®Œæ•´çš„å‰åç«¯ä»£ç 
- âœ… æ‰€æœ‰åŠŸèƒ½é¡µé¢
- âœ… å®¡è®¡æ—¥å¿—ç³»ç»Ÿ
- âœ… ç§æœ‰ç…§ç‰‡è®¿é—®
- âœ… å¤–éƒ¨ API è°ƒç”¨ï¼ˆå‚æ•°å†™æ­»ï¼‰
- âœ… å®Œæ•´æ–‡æ¡£å’Œéƒ¨ç½²è¯´æ˜
- âœ… curl API æµ‹è¯•ç¤ºä¾‹
- âœ… å¯åŠ¨è„šæœ¬

**å¯ç›´æ¥è¿è¡Œå’Œéƒ¨ç½²åˆ° Renderï¼** ğŸš€
